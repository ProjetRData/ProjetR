---
title: "Analyse des facteurs influen√ßant le loyer des logements √† Dakar"
author: "Groupe X - Noms des membres"
date: "`r format(Sys.Date(), '%d %B %Y')`"
output:
  html_document:
    theme: flatly
    toc: true
    toc_float: 
      collapsed: false
      smooth_scroll: true
    toc_depth: 3
    number_sections: true
    code_folding: hide
    df_print: kable
    highlight: tango
---

```{css echo=FALSE}
/* Am√©lioration des marges et espacements */
.section h2, .section h3 {
  margin-top: 2em;
  margin-bottom: 1em;
}

/* Alignement des nombres dans les tables */
table td:nth-child(n+2) {
  text-align: right;
}

table td:first-child {
  text-align: left;
}

/* Footer fixe et √©l√©gant */
.footer-custom {
  margin-top: 4em;
  padding: 2em;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border-radius: 10px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Am√©lioration des tabsets */
.nav-tabs {
  margin-bottom: 1.5em;
}

/* Responsive pour mobile */
@media (max-width: 768px) {
  .main-container {
    padding: 10px;
  }
  
  .section h2 {
    font-size: 1.5em;
  }
  
  table {
    font-size: 0.85em;
  }
}

/* Am√©lioration des graphiques */
img {
  max-width: 100%;
  height: auto;
  border-radius: 5px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.align = "center",
  fig.width = 12,
  fig.height = 8,
  dpi = 100
)
```

```{r libraries, include=FALSE}
library(dplyr)
library(ggplot2)
library(tidyr)
library(corrplot)
library(knitr)
library(kableExtra)
library(gridExtra)
library(scales)
library(forcats)
library(patchwork)

# Th√®me personnalis√©
theme_custom <- theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold", hjust = 0.5, margin = margin(b = 10)),
    plot.subtitle = element_text(size = 11, hjust = 0.5, color = "gray40", margin = margin(b = 15)),
    axis.title = element_text(size = 11, face = "bold"),
    legend.position = "bottom",
    panel.grid.minor = element_blank(),
    plot.margin = margin(10, 10, 10, 10),
    panel.background = element_rect(fill = "white", color = NA),
    plot.background = element_rect(fill = "white", color = NA)
  )

theme_set(theme_custom)

# Palette de couleurs
couleurs_principales <- c("#2E86AB", "#A23B72", "#F18F01", "#C73E1D", "#6A994E")
couleur_outliers <- "#E63946"
```

```{r chargement, include=FALSE}
dakar <- read.csv("dakar.csv", stringsAsFactors = TRUE)

dakar_clean <- dakar %>%
  drop_na(Loyer) %>%
  mutate(
    PrixM2Terrain = ifelse(SurfTerrain > 0, Loyer / SurfTerrain, NA),
    PrixM2Habitable = ifelse(SurfHabitable > 0, Loyer / SurfHabitable, NA),
    RatioHabitable = ifelse(SurfTerrain > 0, SurfHabitable / SurfTerrain, NA),
    TotalSDB_WC = NbSDB + NbWC,
    Standing = factor(Standing, levels = c("Non", "Oui")),
    Etat = factor(Etat, levels = c("Vetuste", "Mediocre", "Bon", "Neuf")),
    StandingQuartier = factor(StandingQuartier, 
                              levels = c("popu", "moy", "bourge"),
                              labels = c("Populaire", "Moyen", "Bourgeois"))
  )

n_obs <- nrow(dakar_clean)

na_summary <- dakar_clean %>%
  summarise(across(everything(), ~sum(is.na(.)))) %>%
  pivot_longer(everything(), names_to = "Variable", values_to = "NA_count") %>%
  filter(NA_count > 0) %>%
  arrange(desc(NA_count))
```

# Introduction {.tabset}

## Contexte

Le march√© immobilier de Dakar pr√©sente une grande h√©t√©rog√©n√©it√© refl√©tant les disparit√©s socio-√©conomiques de la ville. Avec **`r format(n_obs, big.mark = " ")` logements** analys√©s, cette √©tude vise √† comprendre les m√©canismes de formation des prix.

## Probl√©matique

**Question centrale :** Quels sont les facteurs d√©terminants du prix de location des logements √† Dakar ?

**Hypoth√®ses √† tester :**

1. Les caract√©ristiques physiques influencent le loyer
2. Le standing et l'√©tat jouent un r√¥le significatif
3. La localisation est un facteur majeur
4. Les √©quipements impactent le prix
5. Le standing du quartier influe ind√©pendamment

## Objectifs

1. **Explorer** la distribution des loyers et identifier les segments
2. **Analyser** les relations entre loyer et facteurs explicatifs
3. **Quantifier** l'impact relatif de chaque variable
4. **Construire** un mod√®le pr√©dictif robuste
5. **Proposer** des recommandations pratiques

# Description des donn√©es

## Pr√©sentation g√©n√©rale

Le jeu de donn√©es comprend **`r format(n_obs, big.mark = " ")` logements** d√©crits par **29 variables**.

```{r categories}
categories <- data.frame(
  Cat√©gorie = c("Identification", "Prix", "Surfaces", "Composition", 
                "Type & Standing", "√âtat", "√âquipements", "Localisation"),
  Variables = c("id", "Loyer", "SurfTerrain, SurfHabitable, SurfPiecResid",
    "NbPieces, NbPiecesResid, NbSDB, NbChamBur, NbSalonsSAM, NbWC, NbCuis",
    "Type, Standing, StandingQuartier", "Etat",
    "Jardin, Cour, Piscine, Garage, Egout, HiTech",
    "DistCtrVille, Commerc, BordMer, Distractions, AxeRoutier, QuartierAffaires, Quartier"),
  Nombre = c(1, 1, 3, 7, 3, 1, 6, 7)
)

categories %>%
  kable(caption = "Cat√©gorisation des variables", align = "llc") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), 
                full_width = FALSE, position = "center") %>%
  column_spec(1, bold = TRUE, width = "8em") %>%
  column_spec(3, width = "5em")
```

## Aper√ßu des donn√©es

```{r apercu}
dakar_clean %>%
  select(id, Loyer, Type, SurfTerrain, SurfHabitable, NbPieces, 
         Standing, Etat, Quartier, BordMer) %>%
  head(10) %>%
  mutate(Loyer = format(Loyer, big.mark = " ")) %>%
  kable(caption = "√âchantillon de 10 logements", 
        align = "lrclrrllll",
        col.names = c("ID", "Loyer", "Type", "Surf. Terrain", "Surf. Hab.", 
                      "Pi√®ces", "Standing", "√âtat", "Quartier", "Bord Mer")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),
                full_width = TRUE, font_size = 11)
```

## Statistiques descriptives

```{r stats_desc}
stats_continues <- dakar_clean %>%
  select(Loyer, SurfTerrain, SurfHabitable, NbPieces, NbChamBur, NbSDB) %>%
  pivot_longer(everything(), names_to = "Variable", values_to = "Valeur") %>%
  group_by(Variable) %>%
  summarise(
    N = sum(!is.na(Valeur)),
    Min = min(Valeur, na.rm = TRUE),
    Q1 = quantile(Valeur, 0.25, na.rm = TRUE),
    M√©diane = median(Valeur, na.rm = TRUE),
    Moyenne = mean(Valeur, na.rm = TRUE),
    Q3 = quantile(Valeur, 0.75, na.rm = TRUE),
    Max = max(Valeur, na.rm = TRUE),
    `√âcart-type` = sd(Valeur, na.rm = TRUE)
  ) %>%
  mutate(across(where(is.numeric) & !N, ~round(., 1)))

stats_continues %>%
  kable(caption = "Statistiques des variables quantitatives", 
        align = "lrrrrrrrr") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE) %>%
  column_spec(1, bold = TRUE)
```

```{r na_check}
if(nrow(na_summary) > 0) {
  na_summary %>%
    mutate(Pourcentage = round(NA_count / n_obs * 100, 1)) %>%
    kable(caption = "Variables avec valeurs manquantes",
          align = "lrr",
          col.names = c("Variable", "Nombre NA", "% NA")) %>%
    kable_styling(bootstrap_options = c("striped", "hover"),
                  full_width = FALSE, position = "left") %>%
    print()
}
```

# Analyse univari√©e

## Le loyer : variable cible

```{r analyse_loyer, fig.height=9, fig.width=12}
stats_loyer <- dakar_clean %>%
  summarise(
    Minimum = min(Loyer), Q1 = quantile(Loyer, 0.25),
    M√©diane = median(Loyer), Moyenne = mean(Loyer),
    Q3 = quantile(Loyer, 0.75), Maximum = max(Loyer),
    √âcart_type = sd(Loyer), CV = sd(Loyer)/mean(Loyer)
  )

p1 <- ggplot(dakar_clean, aes(x = Loyer)) +
  geom_histogram(aes(y = after_stat(density)), fill = couleurs_principales[1], 
                 color = "white", bins = 30, alpha = 0.8) +
  geom_density(color = couleurs_principales[2], linewidth = 1.5) +
  geom_vline(xintercept = stats_loyer$Moyenne, color = couleur_outliers, 
             linetype = "dashed", linewidth = 1) +
  geom_vline(xintercept = stats_loyer$M√©diane, color = couleurs_principales[5], 
             linetype = "dashed", linewidth = 1) +
  labs(title = "Distribution des loyers",
       subtitle = sprintf("Moyenne: %s | M√©diane: %s", 
                         format(round(stats_loyer$Moyenne, 0), big.mark = " "),
                         format(round(stats_loyer$M√©diane, 0), big.mark = " ")),
       x = "Loyer mensuel (FCFA)", y = "Densit√©") +
  scale_x_continuous(labels = label_number(big.mark = " "))

p2 <- ggplot(dakar_clean, aes(x = "", y = Loyer)) +
  geom_boxplot(fill = couleurs_principales[3], alpha = 0.7, 
               outlier.color = couleur_outliers, outlier.alpha = 0.6) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 4, 
               fill = couleur_outliers, color = "white", stroke = 1) +
  labs(title = "Boxplot des loyers", 
       subtitle = "‚óÜ = Moyenne | Ligne = M√©diane",
       x = "", y = "Loyer mensuel (FCFA)") +
  scale_y_continuous(labels = label_number(big.mark = " "))

p3 <- ggplot(dakar_clean, aes(sample = Loyer)) +
  stat_qq(color = couleurs_principales[1], alpha = 0.6, size = 2) +
  stat_qq_line(color = couleur_outliers, linetype = "dashed", linewidth = 1) +
  labs(title = "Q-Q Plot", 
       subtitle = "Test de normalit√©",
       x = "Quantiles th√©oriques", y = "Quantiles observ√©s")

p4 <- dakar_clean %>%
  mutate(Segment = case_when(
    Loyer < 100 ~ "< 100",
    Loyer < 300 ~ "100-300",
    Loyer < 600 ~ "300-600",
    Loyer < 1000 ~ "600-1000",
    TRUE ~ "> 1000"
  )) %>%
  count(Segment) %>%
  mutate(
    Segment = factor(Segment, levels = c("< 100", "100-300", "300-600", "600-1000", "> 1000")),
    Pourcentage = n / sum(n) * 100
  ) %>%
  ggplot(aes(x = Segment, y = n, fill = Segment)) +
  geom_col(show.legend = FALSE, alpha = 0.85) +
  geom_text(aes(label = sprintf("%d\n(%.1f%%)", n, Pourcentage)), 
            vjust = -0.5, size = 3.5, fontface = "bold") +
  scale_fill_manual(values = couleurs_principales) +
  labs(title = "Segmentation du march√©",
       x = "Tranche de loyer", y = "Nombre de logements") +
  ylim(0, NA)

(p1 + p2) / (p3 + p4) + 
  plot_annotation(title = "Analyse compl√®te de la variable Loyer",
                  theme = theme(plot.title = element_text(size = 16, face = "bold", hjust = 0.5)))
```

```{r stats_loyer_table}
stats_loyer %>%
  pivot_longer(everything(), names_to = "Statistique", values_to = "Valeur") %>%
  mutate(Valeur = ifelse(Statistique == "CV", 
                        sprintf("%.2f", Valeur),
                        format(round(Valeur, 0), big.mark = " "))) %>%
  kable(caption = "Statistiques descriptives du loyer", align = "lr") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), 
                full_width = FALSE, position = "center")
```

## Surfaces

```{r analyse_surfaces, fig.height=9, fig.width=12}
p1 <- ggplot(dakar_clean, aes(x = SurfTerrain)) +
  geom_histogram(fill = couleurs_principales[1], color = "white", bins = 30, alpha = 0.8) +
  labs(title = "Surface du terrain", x = "Surface (m¬≤)", y = "Fr√©quence")

p2 <- ggplot(dakar_clean, aes(x = SurfHabitable)) +
  geom_histogram(fill = couleurs_principales[2], color = "white", bins = 30, alpha = 0.8) +
  labs(title = "Surface habitable", x = "Surface (m¬≤)", y = "Fr√©quence")

p3 <- ggplot(dakar_clean %>% filter(!is.na(RatioHabitable)), aes(x = RatioHabitable)) +
  geom_histogram(fill = couleurs_principales[3], color = "white", bins = 30, alpha = 0.8) +
  labs(title = "Ratio Surface habitable / Terrain", x = "Ratio (0-1)", y = "Fr√©quence")

p4 <- ggplot(dakar_clean %>% filter(!is.na(RatioHabitable)), 
             aes(x = Type, y = RatioHabitable, fill = Type)) +
  geom_boxplot(alpha = 0.8, outlier.shape = NA) +
  geom_jitter(width = 0.2, alpha = 0.3, size = 1) +
  scale_fill_manual(values = couleurs_principales) +
  labs(title = "Ratio par type de logement", x = "Type", y = "Ratio") +
  theme(legend.position = "none") +
  coord_cartesian(ylim = c(0, 1))

(p1 + p2) / (p3 + p4) +
  plot_annotation(title = "Analyse des surfaces",
                  theme = theme(plot.title = element_text(size = 16, face = "bold", hjust = 0.5)))
```

## Type et standing

```{r analyse_type, fig.height=10, fig.width=12}
p1 <- dakar_clean %>%
  count(Type) %>%
  mutate(Pourcentage = n/sum(n)*100) %>%
  ggplot(aes(x = fct_reorder(Type, n), y = n, fill = Type)) +
  geom_col(show.legend = FALSE, alpha = 0.85) +
  geom_text(aes(label = sprintf("%d (%.1f%%)", n, Pourcentage)), 
            hjust = -0.1, size = 3.5) +
  coord_flip() +
  scale_fill_manual(values = couleurs_principales) +
  labs(title = "Type de logement", x = "", y = "Nombre")

p2 <- dakar_clean %>%
  count(Standing) %>%
  mutate(Pourcentage = n/sum(n)*100) %>%
  ggplot(aes(x = Standing, y = n, fill = Standing)) +
  geom_col(show.legend = FALSE, alpha = 0.85, width = 0.6) +
  geom_text(aes(label = sprintf("%d\n(%.1f%%)", n, Pourcentage)), 
            vjust = -0.5, size = 4) +
  scale_fill_manual(values = couleurs_principales[1:2]) +
  labs(title = "Standing", x = "", y = "Nombre")

p3 <- dakar_clean %>%
  count(Etat) %>%
  mutate(Pourcentage = n/sum(n)*100) %>%
  ggplot(aes(x = Etat, y = n, fill = Etat)) +
  geom_col(show.legend = FALSE, alpha = 0.85, width = 0.7) +
  geom_text(aes(label = sprintf("%d\n(%.1f%%)", n, Pourcentage)), 
            vjust = -0.5, size = 3.5) +
  scale_fill_manual(values = couleurs_principales) +
  labs(title = "√âtat des logements", x = "", y = "Nombre")

p4 <- dakar_clean %>%
  count(StandingQuartier) %>%
  mutate(Pourcentage = n/sum(n)*100) %>%
  ggplot(aes(x = StandingQuartier, y = n, fill = StandingQuartier)) +
  geom_col(show.legend = FALSE, alpha = 0.85, width = 0.7) +
  geom_text(aes(label = sprintf("%d\n(%.1f%%)", n, Pourcentage)), 
            vjust = -0.5, size = 4) +
  scale_fill_manual(values = couleurs_principales[1:3]) +
  labs(title = "Standing du quartier", x = "", y = "Nombre")

(p1 + p2) / (p3 + p4) +
  plot_annotation(title = "Caract√©ristiques qualitatives",
                  theme = theme(plot.title = element_text(size = 16, face = "bold", hjust = 0.5)))
```

# Analyse bivari√©e

## Loyer vs Surfaces

```{r bivar_surfaces, fig.height=10, fig.width=12}
cor_terrain <- cor(dakar_clean$Loyer, dakar_clean$SurfTerrain, use = "complete.obs")
cor_habitable <- cor(dakar_clean$Loyer, dakar_clean$SurfHabitable, use = "complete.obs")

p1 <- ggplot(dakar_clean, aes(x = SurfTerrain, y = Loyer)) +
  geom_point(alpha = 0.5, color = couleurs_principales[1], size = 2) +
  geom_smooth(method = "lm", color = couleur_outliers, se = TRUE, linewidth = 1.2) +
  labs(title = "Loyer vs Surface terrain",
       subtitle = sprintf("Corr√©lation: r = %.3f", cor_terrain),
       x = "Surface terrain (m¬≤)", y = "Loyer (FCFA)")

p2 <- ggplot(dakar_clean, aes(x = SurfHabitable, y = Loyer)) +
  geom_point(alpha = 0.5, color = couleurs_principales[2], size = 2) +
  geom_smooth(method = "lm", color = couleur_outliers, se = TRUE, linewidth = 1.2) +
  labs(title = "Loyer vs Surface habitable",
       subtitle = sprintf("Corr√©lation: r = %.3f", cor_habitable),
       x = "Surface habitable (m¬≤)", y = "Loyer (FCFA)")

p3 <- ggplot(dakar_clean %>% filter(!is.na(PrixM2Habitable), PrixM2Habitable < 20), 
             aes(x = PrixM2Habitable)) +
  geom_histogram(fill = couleurs_principales[3], color = "white", bins = 30, alpha = 0.8) +
  geom_vline(xintercept = median(dakar_clean$PrixM2Habitable, na.rm = TRUE),
             color = couleur_outliers, linetype = "dashed", linewidth = 1) +
  labs(title = "Prix au m¬≤ habitable", x = "Prix/m¬≤ (FCFA)", y = "Fr√©quence")

p4 <- ggplot(dakar_clean %>% filter(!is.na(PrixM2Habitable)), 
             aes(x = Type, y = PrixM2Habitable, fill = Type)) +
  geom_boxplot(alpha = 0.8, outlier.shape = NA) +
  scale_fill_manual(values = couleurs_principales) +
  labs(title = "Prix/m¬≤ par type", x = "Type", y = "Prix/m¬≤ (FCFA)") +
  theme(legend.position = "none") +
  coord_cartesian(ylim = c(0, 15))

(p1 + p2) / (p3 + p4) +
  plot_annotation(title = "Relation entre loyer et surfaces",
                  theme = theme(plot.title = element_text(size = 16, face = "bold", hjust = 0.5)))
```

## Loyer vs Type et Standing

```{r bivar_standing, fig.height=10, fig.width=12}
p1 <- ggplot(dakar_clean, aes(x = Type, y = Loyer, fill = Type)) +
  geom_boxplot(alpha = 0.8, outlier.shape = NA) +
  geom_jitter(width = 0.2, alpha = 0.2, size = 1.5) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 4, 
               fill = couleur_outliers, color = "white", stroke = 1.5) +
  scale_fill_manual(values = couleurs_principales) +
  labs(title = "Loyers par type", x = "Type", y = "Loyer (FCFA)") +
  scale_y_continuous(limits = c(0, quantile(dakar_clean$Loyer, 0.95))) +
  theme(legend.position = "none")

p2 <- ggplot(dakar_clean, aes(x = Standing, y = Loyer, fill = Standing)) +
  geom_violin(alpha = 0.3, draw_quantiles = c(0.25, 0.5, 0.75)) +
  geom_boxplot(width = 0.3, alpha = 0.8, outlier.shape = NA) +
  scale_fill_manual(values = couleurs_principales[1:2]) +
  labs(title = "Loyer selon standing", x = "Standing", y = "Loyer (FCFA)") +
  scale_y_continuous(limits = c(0, quantile(dakar_clean$Loyer, 0.95))) +
  theme(legend.position = "none")

p3 <- ggplot(dakar_clean, aes(x = Etat, y = Loyer, fill = Etat)) +
  geom_boxplot(alpha = 0.8, outlier.shape = NA) +
  geom_jitter(width = 0.2, alpha = 0.2, size = 1.5) +
  scale_fill_manual(values = couleurs_principales) +
  labs(title = "Loyer selon √©tat", x = "√âtat", y = "Loyer (FCFA)") +
  scale_y_continuous(limits = c(0, quantile(dakar_clean$Loyer, 0.95))) +
  theme(legend.position = "none")

p4 <- ggplot(dakar_clean, aes(x = StandingQuartier, y = Loyer, fill = StandingQuartier)) +
  geom_boxplot(alpha = 0.8, outlier.shape = NA) +
  geom_jitter(width = 0.2, alpha = 0.2, size = 1.5) +
  scale_fill_manual(values = couleurs_principales[1:3]) +
  labs(title = "Loyer selon standing quartier", x = "Standing", y = "Loyer (FCFA)") +
  scale_y_continuous(limits = c(0, quantile(dakar_clean$Loyer, 0.95))) +
  theme(legend.position = "none")

(p1 + p2) / (p3 + p4) +
  plot_annotation(title = "Impact du type et du standing sur le loyer",
                  theme = theme(plot.title = element_text(size = 16, face = "bold", hjust = 0.5)))
```

## Matrice de corr√©lation

```{r correlations, fig.height=9, fig.width=12}
vars_numeriques <- dakar_clean %>%
  select(Loyer, SurfTerrain, SurfHabitable, NbPieces, NbPiecesResid,
         NbSDB, NbChamBur, NbSalonsSAM, NbWC, NbCuis, TotalSDB_WC,
         PrixM2Habitable, RatioHabitable) %>%
  select(where(is.numeric))

cor_matrix <- cor(vars_numeriques, use = "complete.obs")

corrplot(cor_matrix, 
         method = "color", 
         type = "upper",
         tl.col = "black", 
         tl.srt = 45, 
         tl.cex = 0.9,
         addCoef.col = "black", 
         number.cex = 0.7,
         col = colorRampPalette(c(couleurs_principales[1], "white", couleurs_principales[2]))(200),
         title = "Matrice de corr√©lation",
         mar = c(0, 0, 3, 0),
         cl.cex = 0.8)
```

# Tests statistiques

```{r tests_anova}
vars_qualitatives <- c("Type", "Standing", "Etat", "StandingQuartier", 
                       "Jardin", "Piscine", "Garage", "Egout", "BordMer")

resultats_anova <- data.frame()

for(var in vars_qualitatives) {
  if(var %in% names(dakar_clean)) {
    formule <- as.formula(paste("Loyer ~", var))
    anova_result <- aov(formule, data = dakar_clean)
    anova_summary <- summary(anova_result)
    
    p_value <- anova_summary[[1]]$`Pr(>F)`[1]
    f_value <- anova_summary[[1]]$`F value`[1]
    ss_effect <- anova_summary[[1]]$`Sum Sq`[1]
    ss_total <- sum(anova_summary[[1]]$`Sum Sq`)
    eta_sq <- ss_effect / ss_total
    
    resultats_anova <- rbind(resultats_anova, data.frame(
      Variable = var,
      F_stat = round(f_value, 2),
      P_value = format.pval(p_value, digits = 3),
      Eta_carr√© = round(eta_sq, 3),
      Signif = ifelse(p_value < 0.001, "***",
                     ifelse(p_value < 0.01, "**",
                           ifelse(p_value < 0.05, "*", "ns")))
    ))
  }
}

resultats_anova %>%
  arrange(desc(Eta_carr√©)) %>%
  kable(caption = "Tests ANOVA", align = "lrrlc",
        col.names = c("Variable", "F", "P-value", "Œ∑¬≤", "Signif.")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE) %>%
  column_spec(5, bold = TRUE) %>%
  footnote(general = "Significativit√© : *** p<0.001, ** p<0.01, * p<0.05, ns : non significatif",
           general_title = "Note :")
```

# Mod√©lisation

## Mod√®le 1 : R√©gression simple

```{r modele1}
modele1 <- lm(Loyer ~ SurfHabitable, data = dakar_clean)
summary(modele1)
```

**Interpr√©tation :** R¬≤ = `r round(summary(modele1)$r.squared, 3)` - La surface habitable explique **`r round(summary(modele1)$r.squared*100, 1)`%** de la variance du loyer.

## Mod√®le 2 : Caract√©ristiques physiques

```{r modele2}
modele2 <- lm(Loyer ~ SurfHabitable + NbChamBur + NbSDB + Type, data = dakar_clean)
summary(modele2)
```

```{r coef_mod2}
coef_df2 <- as.data.frame(summary(modele2)$coefficients)
coef_df2$Variable <- rownames(coef_df2)
coef_df2 <- coef_df2[, c("Variable", "Estimate", "Std. Error", "t value", "Pr(>|t|)")]

coef_df2 %>%
  mutate(
    Estimate = round(Estimate, 2),
    `Std. Error` = round(`Std. Error`, 2),
    `t value` = round(`t value`, 2),
    `Pr(>|t|)` = format.pval(`Pr(>|t|)`, digits = 3),
    Signif = case_when(
      `Pr(>|t|)` < 0.001 ~ "***",
      `Pr(>|t|)` < 0.01 ~ "**",
      `Pr(>|t|)` < 0.05 ~ "*",
      TRUE ~ "ns"
    )
  ) %>%
  kable(caption = "Coefficients du Mod√®le 2", align = "lrrrlc",
        col.names = c("Variable", "Coefficient", "Erreur std.", "t", "P-value", "Signif.")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE) %>%
  column_spec(6, bold = TRUE)
```

## Mod√®le 3 : Mod√®le complet

```{r modele3}
modele3 <- lm(Loyer ~ SurfHabitable + NbChamBur + NbSDB + Type + 
                     Standing + Etat + StandingQuartier + 
                     Piscine + Garage + BordMer,
              data = dakar_clean)
summary(modele3)
```

```{r coef_mod3}
coef_df3 <- as.data.frame(summary(modele3)$coefficients)
coef_df3$Variable <- rownames(coef_df3)
coef_df3 <- coef_df3[, c("Variable", "Estimate", "Std. Error", "t value", "Pr(>|t|)")]

coef_df3 %>%
  mutate(
    Estimate = round(Estimate, 2),
    `Std. Error` = round(`Std. Error`, 2),
    `t value` = round(`t value`, 2),
    `Pr(>|t|)` = format.pval(`Pr(>|t|)`, digits = 3),
    Signif = case_when(
      `Pr(>|t|)` < 0.001 ~ "***",
      `Pr(>|t|)` < 0.01 ~ "**",
      `Pr(>|t|)` < 0.05 ~ "*",
      TRUE ~ "ns"
    )
  ) %>%
  kable(caption = "Coefficients du Mod√®le 3", align = "lrrrlc",
        col.names = c("Variable", "Coefficient", "Erreur std.", "t", "P-value", "Signif.")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE) %>%
  column_spec(6, bold = TRUE) %>%
  scroll_box(height = "450px")
```

## Comparaison des mod√®les

```{r comparaison_modeles}
comparaison <- data.frame(
  Mod√®le = c("Mod√®le 1: Simple", "Mod√®le 2: Physique", "Mod√®le 3: Complet"),
  Variables = c("SurfHabitable seule", 
                "Surfaces + Composition + Type",
                "Toutes variables pertinentes"),
  N_param = c(length(coef(modele1)), length(coef(modele2)), length(coef(modele3))),
  R2 = c(summary(modele1)$r.squared, summary(modele2)$r.squared, summary(modele3)$r.squared),
  R2_adj = c(summary(modele1)$adj.r.squared, summary(modele2)$adj.r.squared, summary(modele3)$adj.r.squared),
  RMSE = c(sqrt(mean(modele1$residuals^2)), sqrt(mean(modele2$residuals^2)), sqrt(mean(modele3$residuals^2))),
  AIC = c(AIC(modele1), AIC(modele2), AIC(modele3)),
  BIC = c(BIC(modele1), BIC(modele2), BIC(modele3))
) %>%
  mutate(
    R2 = round(R2, 4),
    R2_adj = round(R2_adj, 4),
    RMSE = round(RMSE, 1),
    AIC = round(AIC, 1),
    BIC = round(BIC, 1)
  )

comparaison %>%
  kable(caption = "Comparaison des trois mod√®les", align = "llcrrrrrr",
        col.names = c("Mod√®le", "Variables", "Nb param.", "R¬≤", "R¬≤ ajust√©", "RMSE", "AIC", "BIC")) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE) %>%
  row_spec(3, bold = TRUE, color = "white", background = couleurs_principales[1]) %>%
  column_spec(1, bold = TRUE)
```

## Diagnostics du mod√®le final

```{r diagnostics, fig.height=10, fig.width=12}
par(mfrow = c(2, 2), mar = c(4, 4, 2, 1))
plot(modele3, which = 1:4, col = couleurs_principales[1], pch = 16, cex = 1.2)
```

```{r residus_detail, fig.height=9, fig.width=12}
residus_df <- data.frame(
  Fitted = fitted(modele3),
  Residuals = residuals(modele3),
  Standardized = rstandard(modele3),
  Index = 1:length(residuals(modele3))
)

p1 <- ggplot(residus_df, aes(x = Fitted, y = Residuals)) +
  geom_point(alpha = 0.6, color = couleurs_principales[1], size = 2) +
  geom_hline(yintercept = 0, color = couleur_outliers, linetype = "dashed", linewidth = 1) +
  geom_smooth(se = TRUE, color = couleurs_principales[2], linewidth = 1.2) +
  labs(title = "R√©sidus vs Valeurs ajust√©es", x = "Valeurs ajust√©es", y = "R√©sidus")

p2 <- ggplot(residus_df, aes(sample = Standardized)) +
  stat_qq(color = couleurs_principales[1], alpha = 0.6, size = 2) +
  stat_qq_line(color = couleur_outliers, linetype = "dashed", linewidth = 1) +
  labs(title = "Q-Q Plot", x = "Quantiles th√©oriques", y = "R√©sidus standardis√©s")

p3 <- ggplot(residus_df, aes(x = Index, y = Standardized)) +
  geom_point(alpha = 0.6, color = couleurs_principales[3], size = 2) +
  geom_hline(yintercept = c(-2, 0, 2), linetype = c("dashed", "solid", "dashed"),
             color = c(couleur_outliers, "gray50", couleur_outliers)) +
  labs(title = "R√©sidus standardis√©s", x = "Index", y = "R√©sidus standardis√©s")

p4 <- ggplot(residus_df, aes(x = Residuals)) +
  geom_histogram(aes(y = after_stat(density)), fill = couleurs_principales[4], 
                 color = "white", bins = 30, alpha = 0.8) +
  geom_density(color = couleurs_principales[2], linewidth = 1.5) +
  geom_vline(xintercept = 0, color = couleur_outliers, linetype = "dashed") +
  labs(title = "Distribution des r√©sidus", x = "R√©sidus", y = "Densit√©")

(p1 + p2) / (p3 + p4) +
  plot_annotation(title = "Analyse des r√©sidus du Mod√®le 3",
                  theme = theme(plot.title = element_text(size = 16, face = "bold", hjust = 0.5)))
```

## Pr√©dictions et performance

```{r predictions, fig.height=8, fig.width=12}
dakar_clean$Prediction <- predict(modele3, dakar_clean)
dakar_clean$Erreur <- dakar_clean$Loyer - dakar_clean$Prediction
dakar_clean$Erreur_Pct <- abs(dakar_clean$Erreur / dakar_clean$Loyer * 100)

p1 <- ggplot(dakar_clean, aes(x = Loyer, y = Prediction)) +
  geom_point(alpha = 0.6, color = couleurs_principales[1], size = 3) +
  geom_abline(intercept = 0, slope = 1, color = couleur_outliers, 
              linetype = "dashed", linewidth = 1.5) +
  geom_smooth(method = "lm", se = TRUE, color = couleurs_principales[2], linewidth = 1) +
  labs(title = "Pr√©dictions vs Observations",
       subtitle = sprintf("R¬≤ = %.3f", summary(modele3)$r.squared),
       x = "Loyer observ√© (FCFA)", y = "Loyer pr√©dit (FCFA)")

p2 <- ggplot(dakar_clean, aes(x = Erreur_Pct)) +
  geom_histogram(fill = couleurs_principales[3], color = "white", bins = 25, alpha = 0.8) +
  geom_vline(xintercept = median(dakar_clean$Erreur_Pct), 
             color = couleur_outliers, linetype = "dashed", linewidth = 1) +
  labs(title = "Distribution de l'erreur relative",
       subtitle = sprintf("M√©diane = %.1f%%", median(dakar_clean$Erreur_Pct)),
       x = "Erreur absolue (%)", y = "Fr√©quence")

p1 + p2 +
  plot_annotation(title = "Performance pr√©dictive",
                  theme = theme(plot.title = element_text(size = 16, face = "bold", hjust = 0.5)))
```

```{r performance}
performance <- data.frame(
  M√©trique = c("R¬≤", "R¬≤ ajust√©", "RMSE", "MAE", "MAPE", "M√©diane Err. %"),
  Valeur = c(
    summary(modele3)$r.squared,
    summary(modele3)$adj.r.squared,
    sqrt(mean(dakar_clean$Erreur^2)),
    mean(abs(dakar_clean$Erreur)),
    mean(dakar_clean$Erreur_Pct),
    median(dakar_clean$Erreur_Pct)
  ),
  Interpr√©tation = c(
    sprintf("%.1f%% de variance expliqu√©e", summary(modele3)$r.squared*100),
    sprintf("%.1f%% ajust√©", summary(modele3)$adj.r.squared*100),
    "Erreur quadratique moyenne",
    "Erreur absolue moyenne",
    "Erreur relative moyenne",
    "Erreur relative m√©diane"
  )
) %>%
  mutate(Valeur = round(Valeur, 2))

performance %>%
  kable(caption = "M√©triques de performance", align = "lrl") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE) %>%
  column_spec(1, bold = TRUE) %>%
  row_spec(1:2, background = "#e8f4f8")
```

# Conclusions

## Synth√®se des r√©sultats

### Facteurs d√©terminants du loyer

Le mod√®le final (R¬≤ ajust√© = **`r round(summary(modele3)$adj.r.squared, 3)`**) r√©v√®le :

1. **Caract√©ristiques physiques** (~40%)
   - Surface habitable : facteur principal
   - Nombre de chambres et salles de bain
   - Type de logement

2. **Positionnement et standing** (~35%)
   - Standing du quartier
   - Standing du logement
   - Proximit√© bord de mer

3. **√âquipements premium** (~15%)
   - Piscine
   - Garage

4. **√âtat et qualit√©** (~10%)
   - √âtat g√©n√©ral du logement

### Segmentation du march√©

```{r segments}
dakar_clean %>%
  mutate(Segment = case_when(
    Loyer >= 600 ~ "Haut standing",
    Loyer >= 200 ~ "Moyen standing",
    TRUE ~ "√âconomique"
  )) %>%
  group_by(Segment) %>%
  summarise(
    N = n(),
    `Loyer moyen` = round(mean(Loyer), 0),
    `Loyer m√©dian` = round(median(Loyer), 0),
    `Surf. moy.` = round(mean(SurfHabitable), 0),
    `% Standing` = round(mean(Standing == "Oui") * 100, 1),
    `% Piscine` = round(mean(Piscine == "Oui") * 100, 1)
  ) %>%
  kable(caption = "Segments de march√©", align = "lrrrrrr") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE)
```

## Limites de l'analyse

### Limitations des donn√©es

- **Taille √©chantillon** : `r n_obs` observations
- **Variables manquantes** : Ann√©e de construction, finitions
- **Absence temporelle** : Pas d'√©volution temporelle
- **Valeurs manquantes** : Sur certaines variables d√©riv√©es

### Limitations statistiques

- **H√©t√©rosc√©dasticit√©** : Variance non constante
- **Non-normalit√©** : R√©sidus avec queue lourde
- **Multicolin√©arit√©** : Entre variables de composition
- **Points influents** : Observations √† fort levier

### Recommandations m√©thodologiques

- **Transformation log** pour normaliser
- **Mod√®les robustes** aux outliers
- **Interactions** √† tester
- **Validation crois√©e**

## Recommandations pratiques

### Pour les propri√©taires

üìà **Maximiser la valeur locative :**

- Surface habitable : meilleur ROI
- √âquipements strat√©giques (piscine, garage)
- Maintenir bon √©tat
- Localisation privil√©gi√©e

### Pour les locataires

üè† **Optimiser le rapport qualit√©/prix :**

- Quartiers moyens : bon compromis
- Appartements : meilleur prix/m¬≤
- N√©gocier √©quipements non n√©cessaires
- √âtat "Bon" vs "Neuf"

### Pour d√©cideurs publics

üèõÔ∏è **Politique d'am√©nagement :**

- D√©velopper infrastructures quartiers populaires
- Encourager logements interm√©diaires
- Surveiller zones en gentrification
- Cr√©er observatoire des loyers

## Perspectives

### Am√©liorations court terme

1. Augmenter l'√©chantillon (>1000 logements)
2. Variables compl√©mentaires (ann√©e, charges)
3. G√©olocalisation GPS
4. S√©rie temporelle

### D√©veloppements avanc√©s

```{r perspectives}
perspectives <- data.frame(
  Axe = c("Mod√©lisation", "Donn√©es", "Outils", "Application"),
  Propositions = c(
    "Random Forest, XGBoost, GAM",
    "Web scraping, API g√©ographiques",
    "Shiny dashboard, API pr√©diction",
    "Simulateur r√©novations, estimateur"
  )
)

perspectives %>%
  kable(caption = "Perspectives de d√©veloppement", align = "ll") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = TRUE) %>%
  column_spec(1, bold = TRUE)
```

---
